Mappings:
  RegionMap:
    us-west-2:
      RegionBucket: covid19hpc-quickstart-us-west-2
    us-west-1:
      RegionBucket: covid19hpc-quickstart-us-west-1
    us-east-2:
      RegionBucket: covid19hpc-quickstart-us-east-2
    us-east-1:
      RegionBucket: covid19hpc-quickstart-us-east-1
    eu-central-1:
      RegionBucket: covid19hpc-quickstart-eu-central-1
    ap-southeast-2:
      RegionBucket: covid19hpc-quickstart-ap-southeast-2
    ap-southeast-1:
      RegionBucket: covid19hpc-quickstart-ap-southeast-1
    ca-central-1:
      RegionBucket: covid19hpc-quickstart-ca-central-1
    sa-east-1:
      RegionBucket: covid19hpc-quickstart-sa-east-1
    ap-northeast-1:
      RegionBucket: covid19hpc-quickstart-ap-northeast-1
    ap-northeast-2:
      RegionBucket: covid19hpc-quickstart-ap-northeast-2
    ap-northeast-3:
      RegionBucket: covid19hpc-quickstart-ap-northeast-3
    eu-west-1:
      RegionBucket: covid19hpc-quickstart-eu-west-1
    eu-west-2:
      RegionBucket: covid19hpc-quickstart-eu-west-2
    eu-west-3:
      RegionBucket: covid19hpc-quickstart-eu-west-3
    ap-south-1:
      RegionBucket: covid19hpc-quickstart-ap-south-1
    eu-north-1:
      RegionBucket: covid19hpc-quickstart-eu-north-1


Parameters:
  UserPasswordParameter:
    Type: String
    Description: Set a password for the hpc-quickstart user
    NoEcho: true
  AssetParameterse8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38S3Bucket93190B6E:
    Type: String
    Description: S3 bucket for asset "e8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38"
    Default: "covid19hpc-quickstart"
  AssetParameterse8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38S3VersionKey6275B573:
    Type: String
    Description: S3 key for asset version "e8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38"
    Default: "asset/e8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38.sh||"
  AssetParameterse8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38ArtifactHashB97D64B7:
    Type: String
    Description: Artifact hash for asset "e8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38"
  AssetParametersd188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0fS3Bucket8A68B524:
    Type: String
    Description: S3 bucket for asset "d188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0f"
    Default: "covid19hpc-quickstart"
  AssetParametersd188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0fS3VersionKey3681CC3F:
    Type: String
    Description: S3 key for asset version "d188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0f"
    Default: "asset/d188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0f.sh||"
  AssetParametersd188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0fArtifactHashD19E18AF:
    Type: String
    Description: Artifact hash for asset "d188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0f"
  AssetParameters26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971dS3BucketC5EE12DD:
    Type: String
    Description: S3 bucket for asset "26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971d"
    Default: "covid19hpc-quickstart"
  AssetParameters26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971dS3VersionKey1DA83673:
    Type: String
    Description: S3 key for asset version "26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971d"
    Default: "asset/26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971d.zip||"
  AssetParameters26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971dArtifactHash3101849A:
    Type: String
    Description: Artifact hash for asset "26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971d"
  AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3BucketEC634C0C:
    Type: String
    Description: S3 bucket for asset "1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad"
    Default: "covid19hpc-quickstart"
  AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76:
    Type: String
    Description: S3 key for asset version "1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad"
    Default: "asset/1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad.zip||"
  AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adArtifactHash13E158B7:
    Type: String
    Description: Artifact hash for asset "1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad"
  AssetParameters3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4S3BucketBC8346B6:
    Type: String
    Description: S3 bucket for asset "3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4"
    Default: "covid19hpc-quickstart"
  AssetParameters3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4S3VersionKeyDCCB2D9A:
    Type: String
    Description: S3 key for asset version "3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4"
    Default: "asset/3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4.zip||"
  AssetParameters3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4ArtifactHash2FB69DF7:
    Type: String
    Description: Artifact hash for asset "3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4"
  AssetParameterse61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43S3Bucket9CFBE28B:
    Type: String
    Description: S3 bucket for asset "e61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43"
    Default: "covid19hpc-quickstart"
  AssetParameterse61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43S3VersionKeyDA8E2ECF:
    Type: String
    Description: S3 key for asset version "e61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43"
    Default: "asset/e61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43.zip||"
  AssetParameterse61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43ArtifactHash4E0D620D:
    Type: String
    Description: Artifact hash for asset "e61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43"
  BudgetLimit:
    Type: Number
    Default: 2000
    Description: The initial budget for this project in USD ($).
  NotificationEmail:
    Type: String
    Default: stesachs@amazon.com
    Description: This email address will receive billing alarm notifications when 80% of the budget limit is reached.
Resources:
  VPCB9E5F0B4:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/20
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: pcluster/VPC
    Metadata:
      aws:cdk:path: pcluster/VPC/Resource
  VPCPublicSubnet1SubnetB4246D30:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/Subnet
  VPCPublicSubnet1RouteTableFEE4B781:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/RouteTable
  VPCPublicSubnet1RouteTableAssociation0B0896DC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet1RouteTableFEE4B781
      SubnetId:
        Ref: VPCPublicSubnet1SubnetB4246D30
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/RouteTableAssociation
  VPCPublicSubnet1DefaultRoute91CEF279:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet1RouteTableFEE4B781
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: VPCIGWB7E252D3
    DependsOn:
      - VPCVPCGW99B986DC
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/DefaultRoute
  VPCPublicSubnet1EIP6AD938E8:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/EIP
  VPCPublicSubnet1NATGatewayE0556630:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - VPCPublicSubnet1EIP6AD938E8
          - AllocationId
      SubnetId:
        Ref: VPCPublicSubnet1SubnetB4246D30
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet1/NATGateway
  VPCPublicSubnet2Subnet74179F39:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.4.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
        - Key: aws-cdk:subnet-name
          Value: Public
        - Key: aws-cdk:subnet-type
          Value: Public
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/Subnet
  VPCPublicSubnet2RouteTable6F1A15F1:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/RouteTable
  VPCPublicSubnet2RouteTableAssociation5A808732:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet2RouteTable6F1A15F1
      SubnetId:
        Ref: VPCPublicSubnet2Subnet74179F39
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/RouteTableAssociation
  VPCPublicSubnet2DefaultRouteB7481BBA:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPublicSubnet2RouteTable6F1A15F1
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: VPCIGWB7E252D3
    DependsOn:
      - VPCVPCGW99B986DC
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/DefaultRoute
  VPCPublicSubnet2EIP4947BC00:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/EIP
  VPCPublicSubnet2NATGateway3C070193:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - VPCPublicSubnet2EIP4947BC00
          - AllocationId
      SubnetId:
        Ref: VPCPublicSubnet2Subnet74179F39
      Tags:
        - Key: Name
          Value: pcluster/VPC/PublicSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PublicSubnet2/NATGateway
  VPCPrivateSubnet1Subnet8BCA10E0:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.8.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet1
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/Subnet
  VPCPrivateSubnet1RouteTableBE8A6027:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet1
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/RouteTable
  VPCPrivateSubnet1RouteTableAssociation347902D1:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet1RouteTableBE8A6027
      SubnetId:
        Ref: VPCPrivateSubnet1Subnet8BCA10E0
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/RouteTableAssociation
  VPCPrivateSubnet1DefaultRouteAE1D6490:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet1RouteTableBE8A6027
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: VPCPublicSubnet1NATGatewayE0556630
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet1/DefaultRoute
  VPCPrivateSubnet2SubnetCFCDAA7A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.12.0/22
      VpcId:
        Ref: VPCB9E5F0B4
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet2
        - Key: aws-cdk:subnet-name
          Value: Private
        - Key: aws-cdk:subnet-type
          Value: Private
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/Subnet
  VPCPrivateSubnet2RouteTable0A19E10E:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      Tags:
        - Key: Name
          Value: pcluster/VPC/PrivateSubnet2
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/RouteTable
  VPCPrivateSubnet2RouteTableAssociation0C73D413:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet2RouteTable0A19E10E
      SubnetId:
        Ref: VPCPrivateSubnet2SubnetCFCDAA7A
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/RouteTableAssociation
  VPCPrivateSubnet2DefaultRouteF4F5CFD2:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: VPCPrivateSubnet2RouteTable0A19E10E
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: VPCPublicSubnet2NATGateway3C070193
    Metadata:
      aws:cdk:path: pcluster/VPC/PrivateSubnet2/DefaultRoute
  VPCIGWB7E252D3:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: pcluster/VPC
    Metadata:
      aws:cdk:path: pcluster/VPC/IGW
  VPCVPCGW99B986DC:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId:
        Ref: VPCB9E5F0B4
      InternetGatewayId:
        Ref: VPCIGWB7E252D3
    Metadata:
      aws:cdk:path: pcluster/VPC/VPCGW
  DataRepositoryB58C03BE:
    Type: AWS::S3::Bucket
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: pcluster/DataRepository/Resource
  CloudTrailLogsBBCFF69F:
    Type: AWS::S3::Bucket
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: pcluster/CloudTrailLogs/Resource
  CloudTrailLogsPolicy2265F07C:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: CloudTrailLogsBBCFF69F
      PolicyDocument:
        Statement:
          - Action: s3:GetBucketAcl
            Effect: Allow
            Principal:
              Service: cloudtrail.amazonaws.com
            Resource:
              Fn::GetAtt:
                - CloudTrailLogsBBCFF69F
                - Arn
          - Action: s3:PutObject
            Condition:
              StringEquals:
                s3:x-amz-acl: bucket-owner-full-control
            Effect: Allow
            Principal:
              Service: cloudtrail.amazonaws.com
            Resource:
              Fn::Join:
                - ""
                - - Fn::GetAtt:
                      - CloudTrailLogsBBCFF69F
                      - Arn
                  - /AWSLogs/
                  - Ref: AWS::AccountId
                  - /*
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: pcluster/CloudTrailLogs/Policy/Resource
  CloudTrailA62D711D:
    Type: AWS::CloudTrail::Trail
    Properties:
      IsLogging: true
      S3BucketName:
        Ref: CloudTrailLogsBBCFF69F
      EnableLogFileValidation: true
      EventSelectors: []
      IncludeGlobalServiceEvents: true
      IsMultiRegionTrail: true
    DependsOn:
      - CloudTrailLogsPolicy2265F07C
    Metadata:
      aws:cdk:path: pcluster/CloudTrail/Resource
  Cloud9EnvD28F4C4F:
    Type: AWS::Cloud9::EnvironmentEC2
    Properties:
      InstanceType: c5.large
      Name: ResearchWorkspace
      SubnetId:
        Ref: VPCPublicSubnet1SubnetB4246D30
    Metadata:
      aws:cdk:path: pcluster/Cloud9Env/Resource
  Cloud9CreateKeypairRole4A1B132A:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/Cloud9CreateKeypairRole/Resource
  Cloud9CreateKeypairRoleDefaultPolicyE908AE36:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ec2:CreateKeyPair
              - ec2:DeleteKeyPair
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: Cloud9CreateKeypairRoleDefaultPolicyE908AE36
      Roles:
        - Ref: Cloud9CreateKeypairRole4A1B132A
    Metadata:
      aws:cdk:path: pcluster/Cloud9CreateKeypairRole/DefaultPolicy/Resource
  C9CreateKeyPairLambda8FC204C3:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971dS3VersionKey1DA83673
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971dS3VersionKey1DA83673
      Handler: lambda_function.handler
      Role:
        Fn::GetAtt:
          - Cloud9CreateKeypairRole4A1B132A
          - Arn
      Runtime: python3.6
      Timeout: 300
    DependsOn:
      - Cloud9CreateKeypairRoleDefaultPolicyE908AE36
      - Cloud9CreateKeypairRole4A1B132A
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairLambda/Resource
      aws:asset:path: asset.26ff3816d502d3d269655a55e8c73114e8ef1ae7d56baa1a5afd1a392fce971d
      aws:asset:property: Code
  C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairProvider/framework-onEvent/ServiceRole/Resource
  C9CreateKeyPairProviderframeworkonEventServiceRoleDefaultPolicy904E9C0C:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - C9CreateKeyPairLambda8FC204C3
                - Arn
        Version: "2012-10-17"
      PolicyName: C9CreateKeyPairProviderframeworkonEventServiceRoleDefaultPolicy904E9C0C
      Roles:
        - Ref: C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource
  C9CreateKeyPairProviderframeworkonEvent9134FC48:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76
      Handler: framework.onEvent
      Role:
        Fn::GetAtt:
          - C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17
          - Arn
      Runtime: nodejs10.x
      Environment:
        Variables:
          USER_ON_EVENT_FUNCTION_ARN:
            Fn::GetAtt:
              - C9CreateKeyPairLambda8FC204C3
              - Arn
      Timeout: 900
    DependsOn:
      - C9CreateKeyPairProviderframeworkonEventServiceRoleDefaultPolicy904E9C0C
      - C9CreateKeyPairProviderframeworkonEventServiceRoleE6670C17
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPairProvider/framework-onEvent/Resource
      aws:asset:path: asset.1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad
      aws:asset:property: Code
  C9CreateKeyPair:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - C9CreateKeyPairLambda8FC204C3
          - Arn
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: pcluster/C9CreateKeyPair/Default
  SshPrivateKeySecret:
    Type: AWS::SecretsManager::Secret
    Properties:
      SecretString:
        Fn::GetAtt:
          - C9CreateKeyPair
          - PrivateKey
    Metadata:
      aws:cdk:path: pcluster/SshPrivateKeySecret
  ParallelClusterUserPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ec2:DescribeKeyPairs
              - ec2:DescribeRegions
              - ec2:DescribeVpcs
              - ec2:DescribeSubnets
              - ec2:DescribeSecurityGroups
              - ec2:DescribePlacementGroups
              - ec2:DescribeImages
              - ec2:DescribeInstances
              - ec2:DescribeInstanceStatus
              - ec2:DescribeSnapshots
              - ec2:DescribeVolumes
              - ec2:DescribeVpcAttribute
              - ec2:DescribeAddresses
              - ec2:CreateTags
              - ec2:DescribeNetworkInterfaces
              - ec2:DescribeAvailabilityZones
            Effect: Allow
            Resource: "*"
            Sid: EC2Describe
          - Action:
              - ec2:CreateVpc
              - ec2:ModifyVpcAttribute
              - ec2:DescribeNatGateways
              - ec2:CreateNatGateway
              - ec2:DescribeInternetGateways
              - ec2:CreateInternetGateway
              - ec2:AttachInternetGateway
              - ec2:DescribeRouteTables
              - ec2:CreateRouteTable
              - ec2:AssociateRouteTable
              - ec2:CreateSubnet
              - ec2:ModifySubnetAttribute
            Effect: Allow
            Resource: "*"
            Sid: NetworkingEasyConfig
          - Action:
              - ec2:CreateVolume
              - ec2:RunInstances
              - ec2:AllocateAddress
              - ec2:AssociateAddress
              - ec2:AttachNetworkInterface
              - ec2:AuthorizeSecurityGroupEgress
              - ec2:AuthorizeSecurityGroupIngress
              - ec2:CreateNetworkInterface
              - ec2:CreateSecurityGroup
              - ec2:ModifyVolumeAttribute
              - ec2:ModifyNetworkInterfaceAttribute
              - ec2:DeleteNetworkInterface
              - ec2:DeleteVolume
              - ec2:TerminateInstances
              - ec2:DeleteSecurityGroup
              - ec2:DisassociateAddress
              - ec2:RevokeSecurityGroupIngress
              - ec2:RevokeSecurityGroupEgress
              - ec2:ReleaseAddress
              - ec2:CreatePlacementGroup
              - ec2:DeletePlacementGroup
            Effect: Allow
            Resource: "*"
            Sid: EC2Modify
          - Action:
              - autoscaling:DescribeAutoScalingGroups
              - autoscaling:DescribeAutoScalingInstances
            Effect: Allow
            Resource: "*"
            Sid: AutoScalingDescribe
          - Action:
              - autoscaling:CreateAutoScalingGroup
              - ec2:CreateLaunchTemplate
              - ec2:ModifyLaunchTemplate
              - ec2:DeleteLaunchTemplate
              - ec2:DescribeLaunchTemplates
              - ec2:DescribeLaunchTemplateVersions
              - autoscaling:PutNotificationConfiguration
              - autoscaling:UpdateAutoScalingGroup
              - autoscaling:PutScalingPolicy
              - autoscaling:DescribeScalingActivities
              - autoscaling:DeleteAutoScalingGroup
              - autoscaling:DeletePolicy
              - autoscaling:DisableMetricsCollection
              - autoscaling:EnableMetricsCollection
            Effect: Allow
            Resource: "*"
            Sid: AutoScalingModify
          - Action: dynamodb:DescribeTable
            Effect: Allow
            Resource: "*"
            Sid: DynamoDBDescribe
          - Action:
              - dynamodb:CreateTable
              - dynamodb:DeleteTable
              - dynamodb:TagResource
            Effect: Allow
            Resource: "*"
            Sid: DynamoDBModify
          - Action: sqs:GetQueueAttributes
            Effect: Allow
            Resource: "*"
            Sid: SQSDescribe
          - Action:
              - sqs:CreateQueue
              - sqs:SetQueueAttributes
              - sqs:DeleteQueue
              - sqs:TagQueue
            Effect: Allow
            Resource: "*"
            Sid: SQSModify
          - Action:
              - sns:ListTopics
              - sns:GetTopicAttributes
            Effect: Allow
            Resource: "*"
            Sid: SNSDescribe
          - Action:
              - sns:CreateTopic
              - sns:Subscribe
              - sns:DeleteTopic
            Effect: Allow
            Resource: "*"
            Sid: SNSModify
          - Action:
              - cloudformation:DescribeStackEvents
              - cloudformation:DescribeStackResource
              - cloudformation:DescribeStackResources
              - cloudformation:DescribeStacks
              - cloudformation:ListStacks
              - cloudformation:GetTemplate
            Effect: Allow
            Resource: "*"
            Sid: CloudFormationDescribe
          - Action:
              - cloudformation:CreateStack
              - cloudformation:DeleteStack
              - cloudformation:UpdateStack
            Effect: Allow
            Resource: "*"
            Sid: CloudFormationModify
          - Action:
              - s3:Get*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::ap-east-1-aws-parallelcluster*
              - arn:aws:s3:::ap-northeast-1-aws-parallelcluster*
              - arn:aws:s3:::ap-northeast-2-aws-parallelcluster*
              - arn:aws:s3:::ap-south-1-aws-parallelcluster*
              - arn:aws:s3:::ap-southeast-1-aws-parallelcluster*
              - arn:aws:s3:::ap-southeast-2-aws-parallelcluster*
              - arn:aws:s3:::ca-central-1-aws-parallelcluster*
              - arn:aws:s3:::cn-north-1-aws-parallelcluster*
              - arn:aws:s3:::cn-northwest-1-aws-parallelcluster*
              - arn:aws:s3:::eu-central-1-aws-parallelcluster*
              - arn:aws:s3:::eu-north-1-aws-parallelcluster*
              - arn:aws:s3:::eu-west-1-aws-parallelcluster*
              - arn:aws:s3:::eu-west-2-aws-parallelcluster*
              - arn:aws:s3:::eu-west-3-aws-parallelcluster*
              - arn:aws:s3:::me-south-1-aws-parallelcluster*
              - arn:aws:s3:::sa-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-east-1-aws-parallelcluster*
              - arn:aws:s3:::us-east-2-aws-parallelcluster*
              - arn:aws:s3:::us-west-1-aws-parallelcluster*
              - arn:aws:s3:::us-west-2-aws-parallelcluster*
            Sid: S3ParallelClusterReadOnly
          - Action:
              - iam:PassRole
              - iam:CreateRole
              - iam:CreateServiceLinkedRole
              - iam:DeleteRole
              - iam:GetRole
              - iam:TagRole
              - iam:SimulatePrincipalPolicy
            Effect: Allow
            Resource:
              - arn:aws:iam::*:role/*
              - arn:aws:iam::*:role/aws-service-role/*
            Sid: IAMModify
          - Action:
              - iam:CreateInstanceProfile
              - iam:DeleteInstanceProfile
            Effect: Allow
            Resource: arn:aws:iam::*:instance-profile/*
            Sid: IAMCreateInstanceProfile
          - Action:
              - iam:AddRoleToInstanceProfile
              - iam:RemoveRoleFromInstanceProfile
              - iam:GetRolePolicy
              - iam:GetPolicy
              - iam:AttachRolePolicy
              - iam:DetachRolePolicy
              - iam:PutRolePolicy
              - iam:DeleteRolePolicy
            Effect: Allow
            Resource: "*"
            Sid: IAMInstanceProfile
          - Action:
              - elasticfilesystem:DescribeMountTargets
              - elasticfilesystem:DescribeMountTargetSecurityGroups
              - ec2:DescribeNetworkInterfaceAttribute
            Effect: Allow
            Resource: "*"
            Sid: EFSDescribe
          - Action: ssm:GetParametersByPath
            Effect: Allow
            Resource: "*"
            Sid: SSMDescribe
          - Action: fsx:*
            Effect: Allow
            Resource: "*"
            Sid: FSx
          - Action: elasticfilesystem:*
            Effect: Allow
            Resource: "*"
            Sid: EFS
          - Action:
              - logs:DeleteLogGroup
              - logs:PutRetentionPolicy
              - logs:DescribeLogGroups
              - logs:CreateLogGroup
            Effect: Allow
            Resource: "*"
            Sid: CloudWatchLogs
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: pcluster/ParallelClusterUserPolicy
  Cloud9Role4646BA40:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - ec2.
                    - Ref: AWS::URLSuffix
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonSSMManagedInstanceCore
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSCloud9User
        - Ref: ParallelClusterUserPolicy
    Metadata:
      aws:cdk:path: pcluster/Cloud9Role/Resource
  Cloud9RoleDefaultPolicy7BF05308:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ec2:DescribeInstances
              - ec2:DescribeVolumes
              - ec2:ModifyVolume
            Effect: Allow
            Resource: "*"
          - Action: secretsmanager:GetSecretValue
            Effect: Allow
            Resource:
              Ref: SshPrivateKeySecret
          - Action:
              - s3:Get*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:aws:s3:::"
                    - Ref: DataRepositoryB58C03BE
                    - /*
              - Fn::Join:
                  - ""
                  - - "arn:aws:s3:::"
                    - Ref: DataRepositoryB58C03BE
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
                    - /*
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
              - Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":s3:::"
                    - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
                    - /*
        Version: "2012-10-17"
      PolicyName: Cloud9RoleDefaultPolicy7BF05308
      Roles:
        - Ref: Cloud9Role4646BA40
    Metadata:
      aws:cdk:path: pcluster/Cloud9Role/DefaultPolicy/Resource
  AdminGroupCD52047A:
    Type: AWS::IAM::Group
    Properties:
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSCloud9Administrator
    Metadata:
      aws:cdk:path: pcluster/AdminGroup/Resource
  PowerUserGroupCF23E412:
    Type: AWS::IAM::Group
    Properties:
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/PowerUserAccess
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSCloud9Administrator
    Metadata:
      aws:cdk:path: pcluster/PowerUserGroup/Resource
  ResearcherB0ACBDEC:
    Type: AWS::IAM::User
    Properties:
      Groups:
        - Ref: AdminGroupCD52047A
      LoginProfile:
        Password:
          Ref: UserPasswordParameter
        PasswordResetRequired: true
    Metadata:
      aws:cdk:path: pcluster/Researcher/Resource
  Cloud9SetupRole5712B5A6:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Ref: ParallelClusterUserPolicy
    Metadata:
      aws:cdk:path: pcluster/Cloud9SetupRole/Resource
  Cloud9SetupRoleDefaultPolicy60131F34:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - cloudformation:DescribeStackResources
              - ec2:AssociateIamInstanceProfile
              - ec2:AuthorizeSecurityGroupIngress
              - ec2:DescribeInstances
              - ec2:DescribeInstanceStatus
              - ec2:DescribeInstanceAttribute
              - ec2:DescribeIamInstanceProfileAssociations
              - ec2:DescribeVolumes
              - ec2:DesctibeVolumeAttribute
              - ec2:DescribeVolumesModifications
              - ec2:DescribeVolumeStatus
              - ssm:DescribeInstanceInformation
              - ec2:ModifyVolume
              - ec2:ReplaceIamInstanceProfileAssociation
              - ec2:ReportInstanceStatus
              - ssm:SendCommand
              - ssm:GetCommandInvocation
              - s3:GetObject
              - lambda:AddPermission
              - lambda:RemovePermission
              - events:PutRule
              - events:DeleteRule
              - events:PutTargets
              - events:RemoveTargets
              - cloud9:CreateEnvironmentMembership
            Effect: Allow
            Resource: "*"
          - Action: iam:PassRole
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - Cloud9Role4646BA40
                - Arn
          - Action:
              - lambda:AddPermission
              - lambda:RemovePermission
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: Cloud9SetupRoleDefaultPolicy60131F34
      Roles:
        - Ref: Cloud9SetupRole5712B5A6
    Metadata:
      aws:cdk:path: pcluster/Cloud9SetupRole/DefaultPolicy/Resource
  Cloud9InstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Roles:
        - Ref: Cloud9Role4646BA40
    Metadata:
      aws:cdk:path: pcluster/Cloud9InstanceProfile
  C9InstanceProfileLambdaF4D0173E:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4S3VersionKeyDCCB2D9A
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4S3VersionKeyDCCB2D9A
      Handler: lambda_function.handler
      Role:
        Fn::GetAtt:
          - Cloud9SetupRole5712B5A6
          - Arn
      Runtime: python3.6
      Timeout: 900
    DependsOn:
      - Cloud9SetupRoleDefaultPolicy60131F34
      - Cloud9SetupRole5712B5A6
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileLambda/Resource
      aws:asset:path: asset.3f25d6396cacd93ec80401c4f9ed1b721c13fae79e8ee2e6b66b361bca7507d4
      aws:asset:property: Code
  C9InstanceProfileProviderframeworkonEventServiceRole77941550:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileProvider/framework-onEvent/ServiceRole/Resource
  C9InstanceProfileProviderframeworkonEventServiceRoleDefaultPolicy2FAE1433:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - C9InstanceProfileLambdaF4D0173E
                - Arn
        Version: "2012-10-17"
      PolicyName: C9InstanceProfileProviderframeworkonEventServiceRoleDefaultPolicy2FAE1433
      Roles:
        - Ref: C9InstanceProfileProviderframeworkonEventServiceRole77941550
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource
  C9InstanceProfileProviderframeworkonEvent2F224CFE:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76
      Handler: framework.onEvent
      Role:
        Fn::GetAtt:
          - C9InstanceProfileProviderframeworkonEventServiceRole77941550
          - Arn
      Runtime: nodejs10.x
      Environment:
        Variables:
          USER_ON_EVENT_FUNCTION_ARN:
            Fn::GetAtt:
              - C9InstanceProfileLambdaF4D0173E
              - Arn
      Timeout: 900
    DependsOn:
      - C9InstanceProfileProviderframeworkonEventServiceRoleDefaultPolicy2FAE1433
      - C9InstanceProfileProviderframeworkonEventServiceRole77941550
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfileProvider/framework-onEvent/Resource
      aws:asset:path: asset.1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad
      aws:asset:property: Code
  C9InstanceProfile:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - C9InstanceProfileProviderframeworkonEvent2F224CFE
          - Arn
      InstanceProfile:
        Ref: Cloud9InstanceProfile
      Cloud9Environment:
        Ref: Cloud9EnvD28F4C4F
    DependsOn:
      - Cloud9EnvD28F4C4F
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: pcluster/C9InstanceProfile/Default
  C9BootstrapLambda366B3653:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameterse61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43S3VersionKeyDA8E2ECF
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameterse61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43S3VersionKeyDA8E2ECF
      Handler: lambda_function.handler
      Role:
        Fn::GetAtt:
          - Cloud9SetupRole5712B5A6
          - Arn
      Runtime: python3.6
      Timeout: 900
    DependsOn:
      - Cloud9SetupRoleDefaultPolicy60131F34
      - Cloud9SetupRole5712B5A6
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapLambda/Resource
      aws:asset:path: asset.e61123a66b93fa600436c56dca3fd6281a7a0355b633fd39f15dd13006a35a43
      aws:asset:property: Code
  C9BootstrapProviderframeworkonEventServiceRole9DB6888B:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapProvider/framework-onEvent/ServiceRole/Resource
  C9BootstrapProviderframeworkonEventServiceRoleDefaultPolicy4618A7E0:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - C9BootstrapLambda366B3653
                - Arn
        Version: "2012-10-17"
      PolicyName: C9BootstrapProviderframeworkonEventServiceRoleDefaultPolicy4618A7E0
      Roles:
        - Ref: C9BootstrapProviderframeworkonEventServiceRole9DB6888B
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource
  C9BootstrapProviderframeworkonEvent2A7A53DB:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1adS3VersionKey28104A76
      Handler: framework.onEvent
      Role:
        Fn::GetAtt:
          - C9BootstrapProviderframeworkonEventServiceRole9DB6888B
          - Arn
      Runtime: nodejs10.x
      Environment:
        Variables:
          USER_ON_EVENT_FUNCTION_ARN:
            Fn::GetAtt:
              - C9BootstrapLambda366B3653
              - Arn
      Timeout: 900
    DependsOn:
      - C9BootstrapProviderframeworkonEventServiceRoleDefaultPolicy4618A7E0
      - C9BootstrapProviderframeworkonEventServiceRole9DB6888B
    Metadata:
      aws:cdk:path: pcluster/C9BootstrapProvider/framework-onEvent/Resource
      aws:asset:path: asset.1c9562cbb8db7083c4a0e68da4b60a791cfda099373f7df25d2f438ade62c1ad
      aws:asset:property: Code
  C9Bootstrap:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - C9BootstrapProviderframeworkonEvent2A7A53DB
          - Arn
      Cloud9Environment:
        Ref: Cloud9EnvD28F4C4F
      BootstrapPath:
        Fn::Join:
          - ""
          - - s3://
            - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
            - /
            - Fn::Select:
                - 0
                - Fn::Split:
                    - "||"
                    - Ref: AssetParameterse8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38S3VersionKey6275B573
            - Fn::Select:
                - 1
                - Fn::Split:
                    - "||"
                    - Ref: AssetParameterse8dbc037f5f658580127e34b2809f9daad72ebbe2f67b040817f9012fcc66f38S3VersionKey6275B573
      VPCID:
        Ref: VPCB9E5F0B4
      MasterSubnetID:
        Ref: VPCPublicSubnet1SubnetB4246D30
      ComputeSubnetID:
        Ref: VPCPrivateSubnet1Subnet8BCA10E0
      PostInstallScriptS3Url:
        Fn::Join:
          - ""
          - - s3://
            - !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
            - /
            - Fn::Select:
                - 0
                - Fn::Split:
                    - "||"
                    - Ref: AssetParametersd188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0fS3VersionKey3681CC3F
            - Fn::Select:
                - 1
                - Fn::Split:
                    - "||"
                    - Ref: AssetParametersd188314946020c7335b7a6ab6129c931d21cfba9000a19ff61eaa5c8cb7ecb0fS3VersionKey3681CC3F
      PostInstallScriptBucket:
        !FindInMap [RegionMap, !Ref 'AWS::Region', RegionBucket]
      S3ReadWriteResource:
        Fn::GetAtt:
          - DataRepositoryB58C03BE
          - Arn
      S3ReadWriteUrl:
        Fn::Join:
          - ""
          - - s3://
            - Ref: DataRepositoryB58C03BE
      KeyPairId:
        Ref: C9CreateKeyPair
      KeyPairSecretArn:
        Ref: SshPrivateKeySecret
      UserArn:
        Fn::GetAtt:
          - ResearcherB0ACBDEC
          - Arn
    DependsOn:
      - C9CreateKeyPair
      - C9InstanceProfile
      - DataRepositoryB58C03BE
      - SshPrivateKeySecret
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: pcluster/C9Bootstrap/Default
  CovidHPCBudget:
    Type: AWS::Budgets::Budget
    Properties:
      Budget:
        BudgetLimit:
          Amount:
            Ref: BudgetLimit
          Unit: USD
        BudgetType: COST
        CostTypes:
          IncludeCredit: false
          IncludeDiscount: true
          IncludeOtherSubscription: true
          IncludeRecurring: true
          IncludeRefund: true
          IncludeSubscription: true
          IncludeSupport: true
          IncludeTax: true
          IncludeUpfront: true
          UseAmortized: false
          UseBlended: false
        TimeUnit: ANNUALLY
      NotificationsWithSubscribers:
        - Notification:
            ComparisonOperator: GREATER_THAN
            NotificationType: ACTUAL
            Threshold: 80
            ThresholdType: PERCENTAGE
          Subscribers:
            - Address:
                Ref: NotificationEmail
              SubscriptionType: EMAIL
    Metadata:
      aws:cdk:path: pcluster/CovidHPCBudget
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.32.2,@aws-cdk/assets=1.31.0,@aws-cdk/aws-apigateway=1.31.0,@aws-cdk/aws-applicationautoscaling=1.31.0,@aws-cdk/aws-autoscaling=1.31.0,@aws-cdk/aws-autoscaling-common=1.31.0,@aws-cdk/aws-autoscaling-hooktargets=1.31.0,@aws-cdk/aws-batch=1.31.0,@aws-cdk/aws-budgets=1.31.0,@aws-cdk/aws-certificatemanager=1.31.0,@aws-cdk/aws-cloud9=1.31.0,@aws-cdk/aws-cloudformation=1.31.0,@aws-cdk/aws-cloudfront=1.31.0,@aws-cdk/aws-cloudtrail=1.31.0,@aws-cdk/aws-cloudwatch=1.31.0,@aws-cdk/aws-ec2=1.31.0,@aws-cdk/aws-ecr=1.31.0,@aws-cdk/aws-ecr-assets=1.31.0,@aws-cdk/aws-ecs=1.31.0,@aws-cdk/aws-elasticloadbalancing=1.31.0,@aws-cdk/aws-elasticloadbalancingv2=1.31.0,@aws-cdk/aws-events=1.31.0,@aws-cdk/aws-glue=1.31.0,@aws-cdk/aws-iam=1.31.0,@aws-cdk/aws-kms=1.31.0,@aws-cdk/aws-lambda=1.31.0,@aws-cdk/aws-logs=1.31.0,@aws-cdk/aws-route53=1.31.0,@aws-cdk/aws-route53-targets=1.31.0,@aws-cdk/aws-s3=1.31.0,@aws-cdk/aws-s3-assets=1.31.0,@aws-cdk/aws-sam=1.31.0,@aws-cdk/aws-secretsmanager=1.31.0,@aws-cdk/aws-servicediscovery=1.31.0,@aws-cdk/aws-sns=1.31.0,@aws-cdk/aws-sns-subscriptions=1.31.0,@aws-cdk/aws-sqs=1.31.0,@aws-cdk/aws-ssm=1.31.0,@aws-cdk/aws-stepfunctions=1.31.0,@aws-cdk/aws-stepfunctions-tasks=1.31.0,@aws-cdk/core=1.31.0,@aws-cdk/custom-resources=1.31.0,@aws-cdk/cx-api=1.31.0,@aws-cdk/region-info=1.31.0,jsii-runtime=Python/3.8.2
    Condition: CDKMetadataAvailable
Outputs:
  PublicSubnet0:
    Value:
      Ref: VPCPublicSubnet1SubnetB4246D30
  PublicSubnet1:
    Value:
      Ref: VPCPublicSubnet2Subnet74179F39
  PrivateSubnet0:
    Value:
      Ref: VPCPrivateSubnet1Subnet8BCA10E0
  PrivateSubnet1:
    Value:
      Ref: VPCPrivateSubnet2SubnetCFCDAA7A
  VPCId:
    Value:
      Ref: VPCB9E5F0B4
  ResearchWorkspaceURL:
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: AWS::Region
          - .console.aws.amazon.com/cloud9/ide/
          - Ref: Cloud9EnvD28F4C4F
  UserLoginUrl:
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: AWS::AccountId
          - .signin.aws.amazon.com/console
  UserName:
    Value:
      Ref: ResearcherB0ACBDEC
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

